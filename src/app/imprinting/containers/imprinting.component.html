<div class="container">
  <h1 class="mat-h1">
    각인 최적화
    <a
      class="mat-caption"
      href="https://docs.google.com/presentation/d/e/2PACX-1vQbsDbKRVd-0qRVdLs-tzSUsYMlIFxks6YRO2XzGGdXHm0GACTUwuQxbcXhiAdoHckz7epo4sjQVo9j/pub?start=false&loop=false&delayms=60000"
      target="_blank"
      >설명서</a
    >
  </h1>
  <div class="layout">
    <mat-card class="form-card">
      <mat-card-subtitle>목표 각인</mat-card-subtitle>
      <mat-card-content>
        <div *ngFor="let i of [0, 1, 2, 3, 4, 5]">
          <mat-form-field>
            <mat-label> 각인{{ i + 1 }} </mat-label>
            <input
              type="text"
              matInput
              [(ngModel)]="target[i][0]"
              [matAutocomplete]="auto"
            />
            <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
              <mat-option
                *ngFor="let option of filterImprint(target[i][0])"
                [value]="option"
              >
                {{ option }}
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>
          <mat-form-field class="w-72">
            <mat-label> 수치 </mat-label>
            <mat-select [(ngModel)]="target[i][1]">
              <mat-option [value]="0">미사용</mat-option>
              <mat-option [value]="5">1레벨</mat-option>
              <mat-option [value]="10">2레벨</mat-option>
              <mat-option [value]="15">3레벨</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </mat-card-content>
      <mat-card-subtitle>장착 각인</mat-card-subtitle>
      <mat-card-content>
        <div *ngFor="let i of [0, 1]">
          <mat-form-field>
            <mat-label> 각인{{ i + 1 }} </mat-label>
            <mat-select [(ngModel)]="book[i][0]">
              <mat-option
                *ngFor="let option of getTargetImprints()"
                [value]="option"
              >
                {{ option }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field class="w-72">
            <mat-label> 수치 </mat-label>
            <input [(ngModel)]="book[i][1]" matInput type="number" />
          </mat-form-field>
        </div>
      </mat-card-content>
      <mat-card-subtitle>어빌리티 스톤 각인</mat-card-subtitle>
      <mat-card-content>
        <div *ngFor="let i of [0, 1]">
          <mat-form-field>
            <mat-label> 각인{{ i + 1 }} </mat-label>
            <mat-select [(ngModel)]="stone[i][0]">
              <mat-option
                *ngFor="let option of getTargetImprints()"
                [value]="option"
              >
                {{ option }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field class="w-72">
            <mat-label> 수치 </mat-label>
            <input [(ngModel)]="stone[i][1]" matInput type="number" />
          </mat-form-field>
        </div>
        <mat-form-field>
          <mat-label> 페널티 각인 </mat-label>
          <mat-select [(ngModel)]="stonePenalty[0]">
            <mat-option *ngFor="let option of penaltyOptions" [value]="option">
              {{ option }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field class="w-72">
          <mat-label> 수치 </mat-label>
          <input [(ngModel)]="stonePenalty[1]" matInput type="number" />
        </mat-form-field>
      </mat-card-content>
    </mat-card>
    <mat-card class="form-card">
      <mat-card-subtitle>목걸이</mat-card-subtitle>
      <mat-card-content>
        <mat-form-field class="w-72">
          <mat-label> 전투특성1 </mat-label>
          <mat-select [(ngModel)]="accMap['목걸이'].dealOption1.type">
            <mat-option *ngFor="let option of dealOptions" [value]="option">
              {{ option }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field class="w-72">
          <mat-label> 최소 </mat-label>
          <input
            [(ngModel)]="accMap['목걸이'].dealOption1.min"
            matInput
            type="number"
          />
        </mat-form-field>
        <br />
        <mat-form-field class="w-72">
          <mat-label> 전투특성2 </mat-label>
          <mat-select [(ngModel)]="accMap['목걸이'].dealOption2!.type">
            <mat-option *ngFor="let option of dealOptions" [value]="option">
              {{ option }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field class="w-72">
          <mat-label> 최소 </mat-label>
          <input
            [(ngModel)]="accMap['목걸이'].dealOption2!.min"
            matInput
            type="number"
          />
        </mat-form-field>
        <mat-form-field class="w-72">
          <mat-label> 품질 </mat-label>
          <input
            [(ngModel)]="accMap['목걸이'].quality"
            matInput
            type="number"
          />
        </mat-form-field>
      </mat-card-content>
      <ng-container
        *ngFor="let accType of ['귀걸이1', '귀걸이2', '반지1', '반지2']"
      >
        <mat-card-subtitle>{{ accType }}</mat-card-subtitle>
        <mat-card-content>
          <mat-form-field class="w-72">
            <mat-label> 전투특성1 </mat-label>
            <mat-select [(ngModel)]="accMap[accType].dealOption1.type">
              <mat-option *ngFor="let option of dealOptions" [value]="option">
                {{ option }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field class="w-72">
            <mat-label> 최소 </mat-label>
            <input
              [(ngModel)]="accMap[accType].dealOption1.min"
              matInput
              type="number"
            />
          </mat-form-field>
          <mat-form-field class="w-72">
            <mat-label> 품질 </mat-label>
            <input
              [(ngModel)]="accMap[accType].quality"
              matInput
              type="number"
            />
          </mat-form-field>
        </mat-card-content>
      </ng-container>
      <mat-card-content>
        <button (click)="generate()" mat-raised-button color="primary">
          검색 코드 복사
        </button>
      </mat-card-content>
      <mat-card-content>
        <div class="mat-caption w-240">
          * 지나치게 많이 사용할 시 로스트아크 이용이 제한될 수 있으니, 신중하게
          판단해서 사용해주세요.<br />
          *
          <a
            href="https://docs.google.com/presentation/d/1Xsa6RkciaCwuShltKjNXQDu_LpdlkZLqsNl2KMFXJV4/edit?usp=sharing"
            target="_blank"
            >설명서</a
          >를 읽은 다음 사용해주세요.
        </div>
      </mat-card-content>
    </mat-card>
    <mat-card class="form-card">
      <mat-card-subtitle>검색결과 입력</mat-card-subtitle>
      <mat-card-content>
        <textarea [(ngModel)]="searchResult" matInput class="script"></textarea>
      </mat-card-content>
      <mat-card-subtitle>필터</mat-card-subtitle>
      <mat-card-content>
        <div>
          <mat-form-field class="w-72">
            <mat-label> 치명 </mat-label>
            <input
              [(ngModel)]="filter.effects['치명']"
              matInput
              type="number"
            />
          </mat-form-field>
          <mat-form-field class="w-72">
            <mat-label> 특화 </mat-label>
            <input
              [(ngModel)]="filter.effects['특화']"
              matInput
              type="number"
            />
          </mat-form-field>
          <mat-form-field class="w-72">
            <mat-label> 신속 </mat-label>
            <input
              [(ngModel)]="filter.effects['신속']"
              matInput
              type="number"
            />
          </mat-form-field>
        </div>
        <div>
          <mat-checkbox [(ngModel)]="filter.hasBuyPrice"
            >즉시구매 가능한 조합만 표시</mat-checkbox
          >
        </div>
        <button
          [disabled]="toSearch.length === 0"
          (click)="applySearchResult()"
          mat-raised-button
          color="primary"
        >
          적용
        </button>
      </mat-card-content>
    </mat-card>
    <mat-card class="grow">
      <mat-card-subtitle>추천 조합</mat-card-subtitle>
      <mat-card-content>
        <div class="table-container">
          <div *ngIf="isLoading" class="loading-shade">
            <mat-spinner></mat-spinner>
          </div>
          <div class="table-inner-container">
            <table class="optimize-table" mat-table [dataSource]="dataSource">
              <ng-container matColumnDef="price">
                <th mat-header-cell *matHeaderCellDef>합계</th>
                <td mat-cell *matCellDef="let element">
                  <div>{{ element.price | number: ".0-0" }}골드</div>
                  <div>[치명] +{{ element.effects["치명"] || 0 }}</div>
                  <div>[특화] +{{ element.effects["특화"] || 0 }}</div>
                  <div>[신속] +{{ element.effects["신속"] || 0 }}</div>
                </td>
              </ng-container>

              <ng-container matColumnDef="necklace">
                <th mat-header-cell *matHeaderCellDef>목걸이</th>
                <td mat-cell *matCellDef="let element">
                  <app-item-view
                    [item]="element.items['목걸이']"
                  ></app-item-view>
                </td>
              </ng-container>

              <ng-container matColumnDef="ear1">
                <th mat-header-cell *matHeaderCellDef>귀걸이1</th>
                <td mat-cell *matCellDef="let element">
                  <app-item-view
                    [item]="element.items['귀걸이1']"
                  ></app-item-view>
                </td>
              </ng-container>

              <ng-container matColumnDef="ear2">
                <th mat-header-cell *matHeaderCellDef>귀걸이2</th>
                <td mat-cell *matCellDef="let element">
                  <app-item-view
                    [item]="element.items['귀걸이2']"
                  ></app-item-view>
                </td>
              </ng-container>

              <ng-container matColumnDef="ring1">
                <th mat-header-cell *matHeaderCellDef>반지1</th>
                <td mat-cell *matCellDef="let element">
                  <app-item-view
                    [item]="element.items['반지1']"
                  ></app-item-view>
                </td>
              </ng-container>

              <ng-container matColumnDef="ring2">
                <th mat-header-cell *matHeaderCellDef>반지2</th>
                <td mat-cell *matCellDef="let element">
                  <app-item-view
                    [item]="element.items['반지2']"
                  ></app-item-view>
                </td>
              </ng-container>

              <tr
                mat-header-row
                *matHeaderRowDef="[
                  'price',
                  'necklace',
                  'ear1',
                  'ear2',
                  'ring1',
                  'ring2'
                ]"
              ></tr>
              <tr
                mat-row
                *matRowDef="
                  let row;
                  columns: [
                    'price',
                    'necklace',
                    'ear1',
                    'ear2',
                    'ring1',
                    'ring2'
                  ]
                "
              ></tr>
            </table>
          </div>
          <mat-paginator [pageSize]="4"> </mat-paginator>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
